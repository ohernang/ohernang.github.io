<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PostMessage Sender</title>
</head>
<body>
  <script>
    const message = "Hello World!";
    const interval = 5000; // Intervalo de 5 segundos para el envío de mensajes

    function sendMessage() {
      console.log("Intentando enviar mensaje");

      // Determinar el origen desde el cual se cargó la página
      let parentOrigin = '*'; // Cambiar esto según tus necesidades de seguridad

      if (document.referrer) {
        parentOrigin = new URL(document.referrer).origin;
        console.log("document.referrer es " + document.referrer);
      } else {
        console.log("No document.referrer disponible, usando '*' como origen");
      }

      // Solo enviar mensaje si estamos dentro de un iframe
      if (window.self !== window.top) {
        console.log("La página está en un iframe, enviando mensaje...");
        window.parent.postMessage(message, parentOrigin); // Enviar el mensaje al origen del contenedor
        console.log(`Mensaje enviado a ${parentOrigin}: ${message}`);
      } else {
        console.log('Esta página no se está ejecutando en un iframe o no tiene un contenedor.');
      }
    }

    // Configurar el envío de mensajes en un intervalo
    setInterval(sendMessage, interval);

    // También enviar un mensaje tan pronto como la página cargue y esté lista
    window.addEventListener('DOMContentLoaded', sendMessage);
  </script>
</body>
</html>

